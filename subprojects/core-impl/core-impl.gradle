apply plugin: "groovy"

import org.gradle.build.JarJar

configurations {
    mvn3Input
}


dependencies {
    groovy libraries.groovy

    compile project(":core")

    compile libraries.commons_httpclient
    compile libraries.commons_lang
    compile libraries.commons_io
    compile libraries.ivy
    compile libraries.slf4j_api
    compile libraries.maven_ant_tasks

    testCompile libraries.junit


    compile files("$buildDir/libs/jarjar/mvn3JarJared.jar"){
        builtBy "mvn3JarJar"
    }

    mvn3Input libraries.maven3_settings_builder
}

task mvn3JarJar(type: JarJar) {
    inputFiles = configurations.mvn3Input
    outputFile = file("$buildDir/libs/jarjar/mvn3JarJared.jar")
    rule('org.apache.maven.**', 'org.apache.maven.jarjar.@1')
    keep("org.apache.maven.settings.building.SettingsBuildingResult")
    keep("org.apache.maven.settings.building.SettingsBuildingRequest")
    keep("org.apache.maven.settings.building.SettingsBuildingException")
    keep("org.apache.maven.settings.building.DefaultSettingsBuildingRequest")
    keep("org.apache.maven.settings.building.DefaultSettingsBuilderFactory")
    keep("org.apache.maven.settings.building.DefaultSettingsBuilder")
}

ideaModule.dependsOn mvn3JarJar // I expected that buildable file collections links the ideaModule to the mvn3JarJar task.

useTestFixtures()