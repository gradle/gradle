// Copyright (C) 2023 Gradle, Inc.
//
// Licensed under the Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International License.;
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      https://creativecommons.org/licenses/by-nc-sa/4.0/
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

[[writing_setting_scripts]]
= Settings Scripts Basics

The settings file is the entry point of every Gradle project.

image::author-gradle-1.png[]

Early in the Gradle Build lifecycle, the <<build_lifecycle.adoc#sec:initialization,initialization phase>> finds the settings file in your <<directory_layout#dir:project_root,project root directory>>.

When the settings file `settings.gradle(.kts)` is found, Gradle instantiates a link:{groovyDslPath}/org.gradle.api.initialization.Settings.html[`Settings`] object.

One of the purposes of the `Settings` object is to allow you to declare all the projects to be included in the build.

[[sec:settings_script]]
== Settings scripts

The settings script is either a `settings.gradle` file written in Groovy or a `settings.gradle.kts` file written in Kotlin.

Before Gradle assembles the projects for a build, it creates a `Settings` instance and executes the settings file against it.

As the settings script executes, it configures this `Settings`.

[IMPORTANT]
====
There is a one-to-one correspondence between a `Settings` instance and a `settings.gradle(.kts)` file.

_Settings scripts_ define `Settings` objects.
====

== Settings object

The `Settings` object is part of the link:{javadocPath}/org/gradle/api/initialization/Settings.html[Gradle API].

- In the Groovy DSL, the `Settings` object documentation is found link:{groovyDslPath}/org.gradle.api.initialization.Settings.html[here].
- In the Kotlin DSL, the `Settings` object documentation is found link:{kotlinDslPath}/org.gradle.api.initialization/-settings/index.html[here].

Many top-level properties and blocks in a build script are part of the Settings API.

For example, we can set the root project name in the settings script using the `Settings.rootProject` property:

[source]
----
settings.rootProject.name = "root"
----

Which can be shortened to:

[source]
----
rootProject.name = "root"
----

[[sec:standard_settings_properties]]
=== Standard settings properties

The `Settings` object exposes a standard set of properties in your settings script.

The following table lists a few commonly used properties:

[%autowidth.stretch]
|===
| Name | Description

| `buildCache`
| The build cache configuration.

| `plugins`
| The container of plugins that have been applied to this object.

| `rootDir`
| The root directory of the build. The root directory is the project directory of the root project.

| `rootProject`
| The root project of the build.

| `settings`
| Returns this settings object.
|===

The following table lists a few commonly used methods:

[%autowidth.stretch]
|===
| Name | Description

| `apply()`
| Applies zero or more plugins or scripts.

| `include()`
| Adds the given projects to the build.

| `includeBuild()`
| Includes a build at the specified path to the composite build.
|===

[[sec:the_script_api]]
== The Script API

When Gradle executes a Groovy settings script (`settings.gradle`), it compiles the script into a class that implements link:{groovyDslPath}/org.gradle.api.Script.html[Script].

As a result, settings scripts have access to all properties and methods declared by the `Script` interface.

When Gradle executes a Kotlin settings script (`settings.gradle.kts`), it compiles the script into a subclass of link:{kotlinDslPath}/gradle/org.gradle.kotlin.dsl/-kotlin-settings-script/index.html[KotlinSettingsScript].

As a result, settings scripts have access to all visible properties and functions declared by the `KotlinSettingsScript` type.

== Settings script structure

Let's take a look at an example and break it down:

====
[.multi-language-sample]
=====
.settings.gradle.kts
[source,kotlin]
----
pluginManagement {                                          // <1>
    repositories {
        gradlePluginPortal()
        google()
    }
    includeBuild("../build-logic")
}

plugins {                                                   // <2>
    id("org.gradle.toolchains.fake") version "0.6.0"
}

rootProject.name = "root-project"                           // <3>

dependencyResolutionManagement {                            // <4>
    repositories {
        mavenCentral()
    }
    includeBuild("../other-project")
}

include("sub-project-a")                                    // <5>
include("sub-project-b")
include("sub-project-c")
----
<1> Uses the link:{kotlinDslPath}/gradle/org.gradle.kotlin.dsl/-settings-script-api/plugin-management.html[`pluginManagement()`] method from `KotlinSettingsScript` to locate plugins.
<2> Uses the link:{kotlinDslPath}/gradle/org.gradle.kotlin.dsl/-kotlin-settings-script/plugins.html[`plugins()`] method from `KotlinSettingsScript` to apply plugins.
<3> There is always a root project included in a build.
<4> Add components to the build using the link:{kotlinDslPath}/gradle/org.gradle.api.initialization/-settings/include.html[`Settings.dependencyResolutionManagement()`] method.
<5> Add projects to the build using the link:{kotlinDslPath}/gradle/org.gradle.api.initialization/-settings/include.html[`Settings.include()`] method.
=====

[.multi-language-sample]
=====
.settings.gradle
[source,groovy]
----
pluginManagement {                                          // <1>
    repositories {
        gradlePluginPortal()
        google()
    }
    includeBuild('../build-logic')
}

plugins {                                                   // <2>
    id 'org.gradle.toolchains.fake' version '0.6.0'
}

rootProject.name = 'root-project'                           // <3>

dependencyResolutionManagement {                            // <4>
    repositories {
        mavenCentral()
    }
    includeBuild('../other-project')
}

include('sub-project-a')                                    // <5>
include('sub-project-b')
include('sub-project-c')
----
<1> Uses the link:{javadocPath}/org/gradle/api/initialization/Settings.html#pluginManagement-org.gradle.api.Action-[`pluginManagement`] block to locate plugins.
<2> Uses the link:{groovyDslPath}/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:plugins[`plugins()`] method to apply plugins.
<3> There is always a root project included in a build.
<4> Add components to the build using the link:{javadocPath}/org/gradle/api/initialization/Settings.html#dependencyResolutionManagement-org.gradle.api.Action-[`dependencyResolutionManagement`] block.
<5> Add projects to the build using the link:{groovyDslPath}++/org.gradle.api.initialization.Settings.html#org.gradle.api.initialization.Settings:include(java.lang.String[])++[`include()`] method.
=====
====

=== Define the name

The settings file defines your project name using the `rootProject.name` property:

[source]
----
rootProject.name = "root-project" // settings.rootProject.name = "root-project"
----

There is only one root per project.

=== Define dependency locations

The settings file can optionally define the locations of components your project relies on using `repositories` such as binary repositories like Maven Central and/or other Gradle builds using `includeBuild`:

[source]
----
dependencyResolutionManagement {
    repositories {
        mavenCentral()
    }
    includeBuild("../other-project")
}
----

=== Define shared plugins

The settings file can optionally define the plugins your project uses with `pluginManagement`, including binary repositories such as the Gradle Plugin Portal or other Gradle builds using `includeBuild`:

[source]
----
pluginManagement {
    repositories {
        gradlePluginPortal()
        google()
    }
    includeBuild("../my-build-logic")
}
----

=== Define project structure

The settings file defines the structure of the project by adding all the subprojects using the `include` statement:

[source]
----
include("app")
include("business-logic")
include("data-model")
----

=== Define shared plugins

The settings file can optionally define the plugins which are used as shared configurations among several builds:

[source]
----
plugins {
    id("org.gradle.toolchains.fake") version "0.6.0"
}
----

=== Additional settings

There are many more properties and methods on the `Settings` object that you can use to configure your build.

It's important to remember that while many Gradle scripts are typically written in short Groovy or Kotlin syntax, every item in the settings script is essentially invoking a method on the `Settings` object in the Gradle API:

[source]
----
include("app")
----

Is actually:

[source]
----
settings.include("app")
----

Additionally, the full power of the Groovy and Kotlin languages is available to you.

For example, instead of using `include` many times to add subprojects, you can iterate over the list of directories in the project root folder and include them automatically:

[source]
----
// include("app")
// include("business-logic")
// include("data-model")

rootDir.listFiles().filter { it.isDirectory && !it.isHidden }.forEach {
    include{it.name}
}
----
