abstract class AnimalSearchTask extends DefaultTask {
    @Input
    abstract Property<String> getFind()

    @InputFile
    @PathSensitive(PathSensitivity.ABSOLUTE) // <1>
    abstract RegularFileProperty getCandidatesFile()

    @OutputFile
    abstract RegularFileProperty getResultsFile()

    @TaskAction
    void search() {
        if (candidatesFile.get().getAsFile().readLines().contains(find.get())) {
            def msg = "Found a " + find.get() + "!"
            getLogger().lifecycle(msg)
            resultsFile.get().asFile.text = msg
        }
    }
}

def useAlternateInput = providers.gradleProperty("useAlternateInput").isPresent()

def copyTask = tasks.register("copy", Copy) {
    from(layout.projectDirectory.file("candidates.txt"))
    destinationDir = (useAlternateInput ? layout.buildDirectory.dir("alternateSearchInput") : layout.buildDirectory.dir("searchInput")).get().asFile // <2>
}

tasks.register("search", AnimalSearchTask) {
    find = "cat"
    candidatesFile.fileProvider(copyTask.map { new File(it.destinationDir, "candidates.txt") }) // <3>
    resultsFile = layout.buildDirectory.file("searchOutput/results.txt")
    dependsOn(copyTask)
}
